#-*- coding: utf-8 -*-
import re
import BeautifulSoup
import random
import urllib, httplib 
import urllib2
import sys
import os
reload(sys)
sys.setdefaultencoding('utf-8')

class PhoneInfoSpider():
    def __init__(self,phoneNum):
        self.url = "https://www.sogou.com/web?query="+str(phoneNum)
        self.text='err' 
        self.i_headers = [{"User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36", \
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/5.0 (Linux; U; Android 4.4.2; zh-cn; CHM-TL00H Build/HonorCHM-TL00H) AppleWebKit/533.1 (KHTML, like Gecko)Version/4.0 MQQBrowser/5.4 TBS/025491 Mobile Safari/533.1 MicroMessenger/6.3.13.49_r4080b63.740",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/5.0 (Linux; U; Android 4.3; zh-cn; R2017 Build/JLS36C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30/",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; 2Pac; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Dalvik/1.6.0 (Linux; U; Android 4.4.2; HUAWEI MT7-L09 Build/HuaweiMT7-L09)",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_1 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Mobile/11D201",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; IEMobile/9.0; HTC; 7 Mozart T8698)",\
                     "Referer": 'https://sogou.com/'},
			 {"User-Agent":"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)",\
                     "Referer": 'https://sogou.com/'}
                     ]
        self.proxy_list=[#代理IP
                    '202.106.169.142:80',
                    '220.181.35.109:8080',
                    '124.65.163.10:8080',
                    '117.79.131.109:8080',
                    '58.30.233.200:8080',
                    '115.182.92.87:8080',
                    '210.75.240.62:3128',
                    '211.71.20.246:3128',
                    '115.182.83.38:8080',
                    '121.69.8.234:8080',
                    '27.46.43.225:9797',
                    '42.157.7.14:9999',
                    '27.12.42.251:8090',
                    '119.4.195.21:8088',
                    '14.222.202.34:8090',
                    '59.37.175.99:9797',
                    '189.34.242.120:9002',
                    '112.64.30.192:8090',
                    '175.43.90.91:8118',
                    '124.88.67.20:843',
                    '115.59.166.161:8118',
                    '116.17.8.219:9999',
                    '124.192.167.127:8118',
                    '118.26.118.8:9999',
                    '218.164.112.38:3128',
'172.241.156.51:8118',
'172.241.156.53:8118',
'172.241.156.59:8118',
'172.241.156.61:8118',
'172.241.137.90:8118',
'172.241.137.75:8118',
'172.241.137.73:8118',
'172.241.137.70:8118',
'172.241.137.66:8118',
'172.241.137.22:8118',
'172.241.137.95:8118',
'172.241.137.94:8118',
'172.241.137.107:8118',
'172.241.137.106:8118',
'172.241.137.115:8118',
'182.109.168.252:9000',
'186.92.202.158:8080',
'189.219.197.67:10000',
'119.7.88.188:9000',
'190.203.170.70:8080',
'171.38.35.92:8123',
'201.166.222.6:10000',
'223.151.248.45:9000',
'220.176.92.36:9000',
'187.84.161.209:8080',
'49.113.102.177:8090',
'114.24.144.82:8088',
'59.62.27.82:9000',
'119.134.19.185:8090',
'116.114.0.235:80',
'190.39.240.244:8080',
'114.38.135.100:8088',
'186.94.185.162:8080',
'61.141.155.26:9999',
'205.164.25.68:1212',
'190.199.135.145:8080',
'113.243.193.196:8118',
'113.116.71.176:8090',
'1.163.200.249:8088',
'37.48.112.104:47544',
'104.202.117.193:80',
'200.87.131.52:3128',
'68.144.9.79:1080',
'58.208.197.200:8088',
'61.231.115.23:8088',
'1.60.146.223:9000',
'182.40.54.117:8090',
'190.142.160.73:8080',
'124.161.154.134:9000',
'203.93.104.20:80',
'112.64.29.215:8090',
'201.209.75.89:8080',
'76.8.185.76:10200',
'201.173.93.98:10000',
'103.231.160.18:8080',
'117.178.247.40:8123',
'125.230.57.248:8088',
'220.243.235.175:80',
'190.77.211.253:8080',
'115.218.123.11:9000',
'218.95.54.44:9000',
'186.93.216.43:8080',
'115.223.192.15:9000',
'36.80.64.212:8080',
'190.78.20.35:8080',
'91.98.228.211:8080',
'115.218.122.169:9000',
'117.168.185.45:8123',
'62.78.35.12:3128',
'138.97.247.16:3128',
'189.219.48.107:10000',
'119.177.123.76:9000',
'112.64.29.1:8090',
'187.161.240.159:10000',
'213.196.66.13:80',
'202.162.42.250:8080',
'118.161.185.16:8088',
'82.239.47.219:21320',
'190.207.102.55:8080',
'190.12.39.106:3128',
'115.222.246.62:18186',
'187.161.169.230:10000',
'190.202.181.103:8080',
'183.190.33.139:8080',
'23.247.151.39:37538',
'175.153.91.226:9000',
'118.249.194.123:9000',
'200.84.206.239:8080',
'120.32.121.143:8090',
'155.94.195.12:80',
'189.219.71.16:10000',
'120.195.202.161:80',
'220.187.212.254:8090',
'123.184.145.240:8090',
'201.242.195.174:8080',
'190.207.239.26:8080',
'111.242.97.7:8088',
'1.173.0.172:8088',
'110.8.253.100:80',
'27.41.114.83:8090',
'187.84.161.209:8080',
'117.170.22.164:8123',
'178.189.92.118:3129',
'218.73.143.150:8088',
'112.195.80.83:9000',
'190.74.93.235:8080',
'119.48.182.77:8090',
'218.93.78.122:8090',
'199.255.108.67:8888',
'171.38.40.91:8123',
'114.46.241.138:9064',
'186.91.206.177:8080',
'190.206.59.226:8080',
'122.121.222.145:3128',
        ]
        self.areacode={'北京':10,
'广东广州':20,
'上海':21,
'天津':22,
'重庆':23,
'辽宁抚顺':24,
'辽宁铁岭':24,
'辽宁沈阳':24,
'江苏南京':25,
'湖北武汉':27,
'四川成都':28,
'四川眉山':28,
'四川资阳':28,
'陕西西安':29,
'陕西咸阳':29,
'河北邯郸':310,
'河北石家庄':311,
'河北保定':312,
'河北张家口':313,
'河北承德':314,
'河北唐山':315,
'河北廊坊':316,
'河北沧州':317,
'河北衡水':318,
'河北邢台':319,
'河北秦皇岛':335,
'山西朔州':349,
'山西忻州':350,
'山西太原':351,
'山西大同':352,
'山西阳泉':353,
'山西晋中':354,
'山西长治':355,
'山西晋城':356,
'山西临汾':357,
'山西吕梁':358,
'山西运城':359,
'河南商丘':370,
'河南郑州':371,
'河南安阳':372,
'河南新乡':373,
'河南许昌':374,
'河南平顶山':375,
'河南信阳':376,
'河南南阳':377,
'河南开封':378,
'河南洛阳':379,
'河南焦作':391,
'河南济源':391,
'河南鹤壁':392,
'河南濮阳':393,
'河南周口':394,
'河南漯河':395,
'河南驻马店':396,
'河南三门峡':398,
'辽宁省铁岭市':410,
'辽宁大连':411,
'辽宁鞍山':412,
'辽宁省抚顺市':413,
'辽宁本溪':414,
'辽宁丹东':415,
'辽宁锦州':416,
'辽宁营口':417,
'辽宁阜新':418,
'辽宁辽阳':419,
'辽宁朝阳':421,
'辽宁盘锦':427,
'辽宁葫芦岛':429,
'吉林长春':431,
'吉林吉林':432,
'吉林延边':433,
'吉林四平':434,
'吉林通化':435,
'吉林白城':436,
'吉林辽源':437,
'吉林松原':438,
'吉林白山':439,
'黑龙江哈尔滨':451,
'黑龙江齐齐哈尔':452,
'黑龙江牡丹江':453,
'黑龙江佳木斯':454,
'黑龙江绥化':455,
'黑龙江黑河':456,
'黑龙江大兴安岭':457,
'黑龙江伊春':458,
'黑龙江大庆':459,
'黑龙江七台河':464,
'黑龙江鸡西':467,
'黑龙江鹤岗':468,
'黑龙江双鸭山':469,
'内蒙海拉尔':470,
'内蒙呼和浩特':471,
'内蒙包头':472,
'内蒙乌海':473,
'内蒙集宁':474,
'内蒙通辽':475,
'内蒙赤峰':476,
'内蒙东胜':477,
'内蒙临河':478,
'内蒙锡林浩特':479,
'内蒙兴安盟':482,
'内蒙阿拉善盟':483,
'江苏无锡':510,
'江苏镇江':511,
'江苏苏州':512,
'江苏南通':513,
'江苏扬州':514,
'江苏盐城':515,
'江苏徐州':516,
'江苏淮安':517,
'江苏连云港':518,
'江苏常州':519,
'江苏泰州':523,
'江苏宿迁':527,
'山东菏泽':530,
'山东济南':531,
'山东青岛':532,
'山东淄博':533,
'山东德州':534,
'山东烟台':535,
'山东潍坊':536,
'山东济宁':537,
'山东泰安':538,
'山东临沂':539,
'山东滨州':543,
'山东东营':546,
'安徽滁州':550,
'安徽合肥':551,
'安徽蚌埠':552,
'安徽芜湖':553,
'安徽淮南':554,
'安徽马鞍山':555,
'安徽安庆':556,
'安徽宿州':557,
'安徽阜阳':558,
'安徽亳州':558,
'安徽黄山':559,
'安徽淮北':561,
'安徽铜陵':562,
'安徽宣城':563,
'安徽六安':564,
'安徽巢湖':565,
'安徽池州':566,
'浙江衢州':570,
'浙江杭州':571,
'浙江湖州':572,
'浙江嘉兴':573,
'浙江宁波':574,
'浙江绍兴':575,
'浙江台州':576,
'浙江温州':577,
'浙江丽水':578,
'浙江金华':579,
'浙江舟山':580,
'福建福州':591,
'福建厦门':592,
'福建宁德':593,
'福建莆田':594,
'福建泉州':595,
'福建漳州':596,
'福建龙岩':597,
'福建三明':598,
'福建南平':599,
'山东威海':631,
'山东枣庄':632,
'山东日照':633,
'山东莱芜':634,
'山东聊城':635,
'广东汕尾':660,
'广东阳江':662,
'广东揭阳':663,
'广东茂名':668,
'云南版纳':691,
'云南德宏':692,
'江西鹰潭':701,
'湖北襄樊':710,
'湖北鄂州':711,
'湖北孝感':712,
'湖北黄冈':713,
'湖北黄石':714,
'湖北咸宁':715,
'湖北荆州':716,
'湖北宜昌':717,
'湖北恩施':718,
'湖北十堰':719,
'湖北随州':722,
'湖北荆门':724,
'湖北江汉':728,
'湖北天门':728,
'湖北仙桃':728,
'湖北潜江':728,
'湖南岳阳':730,
'湖南长沙':731,
'湖南湘潭':731,
'湖南株洲':731,
'湖南衡阳':734,
'湖南郴州':735,
'湖南常德':736,
'湖南益阳':737,
'湖南娄底':738,
'湖南邵阳':739,
'湖南吉首':743,
'湖南张家界':744,
'湖南怀化':745,
'湖南永州':746,
'广东江门':750,
'广东韶关':751,
'广东惠州':752,
'广东梅州':753,
'广东汕头':754,
'广东深圳':755,
'广东珠海':756,
'广东佛山':757,
'广东肇庆':758,
'广东湛江':759,
'广东中山':760,
'广东河源':762,
'广东清远':763,
'广东云浮':766,
'广东潮州':768,
'广东东莞':769,
'广西防城港':770,
'广西南宁':771,
'广西柳州':772,
'广西桂林':773,
'广西梧州':774,
'广西玉林':775,
'广西贺州':774,
'广西贵港':775,
'广西百色':776,
'广西钦州':777,
'广西河池':778,
'广西北海':779,
'江西新余':790,
'江西南昌':791,
'江西九江':792,
'江西上饶':793,
'江西抚州':794,
'江西宜春':795,
'江西吉安':796,
'江西赣州':797,
'江西景德镇':798,
'江西萍乡':799,
'四川攀枝花':812,
'四川自贡':813,
'四川绵阳':816,
'四川南充':817,
'四川达县':818,
'四川遂宁':825,
'四川广安':826,
'四川巴中':827,
'四川泸州':830,
'四川宜宾':831,
'四川内江':832,
'四川乐山':833,
'四川西昌':834,
'四川雅安':835,
'四川康定':836,
'四川阿坝':837,
'四川德阳':838,
'四川广元':839,
'贵州贵阳':851,
'贵州遵义':852,
'贵州安顺':853,
'贵州都匀':854,
'贵州凯里':855,
'贵州铜仁':856,
'贵州毕节':857,
'贵州六盘水':858,
'贵州兴义':859,
'云南昭通':870,
'云南昆明':871,
'云南大理':872,
'云南红河':873,
'云南曲靖':874,
'云南保山':875,
'云南文山':876,
'云南玉溪':877,
'云南楚雄':878,
'云南普洱':879,
'云南临沧':883,
'云南怒江':886,
'云南迪庆':887,
'云南丽江':888,
'西藏拉萨':891,
'西藏日喀则':892,
'西藏山南':893,
'西藏林芝':894,
'西藏昌都':895,
'西藏那曲':896,
'西藏阿里':897,
'海南':898,
'新疆塔城':901,
'新疆哈密':902,
'新疆和田':903,
'新疆阿勒泰':906,
'新疆克州':908,
'新疆博州':909,
'陕西延安':911,
'陕西榆林':912,
'陕西渭南':913,
'陕西商州':914,
'陕西安康':915,
'陕西汉中':916,
'陕西宝鸡':917,
'陕西铜川':919,
'甘肃临夏':930,
'甘肃兰州':931,
'甘肃定西':932,
'甘肃平凉':933,
'甘肃西峰':934,
'甘肃金昌':935,
'甘肃武威':935,
'甘肃张掖':936,
'甘肃酒泉':937,
'甘肃嘉峪关':937,
'甘肃天水':938,
'甘肃武都':939,
'甘肃甘南':941,
'甘肃白银':943,
'宁夏银川':951,
'宁夏石嘴山':952,
'宁夏吴忠':953,
'宁夏固原':954,
'宁夏中卫':955,
'青海海北':970,
'青海西宁':971,
'青海海东':972,
'青海黄南':973,
'青海海南':974,
'青海果洛':975,
'青海玉树':976,
'青海海西':977,
'青海格尔木':979,
'新疆克拉玛依':990,
'新疆乌鲁木齐':991,
'新疆奎屯':992,
'新疆石河子':993,
'新疆昌吉':994,
'新疆吐鲁番':995,
'新疆巴音郭楞':996,
'新疆阿克苏':997,
'新疆喀什':998,
'新疆伊犁州':999}
    def useragent(self):
        proxy = random.choice(self.proxy_list)
        urlhandle   = urllib2.ProxyHandler({'http':proxy})
        opener = urllib2.build_opener(urlhandle)
        urllib2.install_opener(opener)
        req = urllib2.Request(self.url, headers=random.choice(self.i_headers))
        return req
    def enterpage(self):
        req=self.useragent()
        file = urllib2.urlopen(req)
        if file.getcode()==200:
           text = file.read()
           file.close()
           text = text.decode("utf-8")
           soup = BeautifulSoup.BeautifulSoup(text)
           text = str(soup.html.body.find('div', 'vrwrap'))
        else:
           file.close()
        return text
    def getcontent(self,phoneNum):
        text=self.enterpage()
        l=''
        if text!='err':
           text = text.split((str(phoneNum)))[-1].split('");')[0].split(' ')
           if len(text)>1:
              if text[0][1:] in self.areacode:
                 code=self.areacode[text[0][1:]]
              else:
                 code=0
              if len(text)>7:
                 if text[0][1:10]=='黑龙江':
                    text[2] = text[0][1:10]+'省'
                    text[0] = text[0][10:]+'市'
                 else:
                    text[0] = text[0][7:]+'市'
                    text[2] = text[0][1:7]+'省'
              else:
                 text[0] = text[0][1:7]+'市'
                 text[2] = text[0]
              l=(str(phoneNum)[:7],text[2],text[0],text[1],code)
        return l
    def SaveRssFile(self,text):
        file=open(tmp.txt,'w')
        file.writelines(text)
        file.close()
if __name__ == "__main__":
    #getPhoneInfo(url,str(i[0])+str(random.randint(1000,9999)))
    #getPhoneInfo(url,13022392846)
    success=[]
    failure=[] 
    phoneNum=13022392846
    phoneInfoSpider=PhoneInfoSpider(phoneNum)
    result=phoneInfoSpider.getcontent(phoneNum)
    if result!='':
       success.append(result)
    else:
       failure.append(str(phoneNum)[:7])
    print success,failure
    
